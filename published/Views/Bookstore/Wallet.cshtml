@model Connect2Us.Models.Wallet

@{ 
    ViewBag.Title = "My Wallet";
}

<h2>@ViewBag.Title</h2>

<div>
    <h4>Current Balance: @Model.Balance.ToString("C")</h4>
    <hr />

    <div class="row">
        <div class="col-md-6">
            @using (Html.BeginForm("AddToWallet", "Bookstore", FormMethod.Post))
            {
                @Html.AntiForgeryToken()

                <div class="form-horizontal">
                    <h4>Add Funds</h4>
                    <hr />
                    @Html.ValidationSummary(true, "", new { @class = "text-danger" })
                    <div class="form-group">
                        <label class="control-label col-md-2">Amount</label>
                        <div class="col-md-10">
                            <input type="number" name="amount" min="1" step="0.01" class="form-control" />
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="col-md-offset-2 col-md-10">
                            <input type="submit" value="Add Funds" class="btn btn-success" />
                        </div>
                    </div>
                </div>
            }
        </div>

        <div class="col-md-6">
            @using (Html.BeginForm("WithdrawFromWallet", "Bookstore", FormMethod.Post))
            {
                @Html.AntiForgeryToken()

                <div class="form-horizontal">
                    <h4>Withdraw Funds</h4>
                    <hr />
                    @Html.ValidationSummary(true, "", new { @class = "text-danger" })
                    <div class="form-group">
                        <label class="control-label col-md-2">Amount</label>
                        <div class="col-md-10">
                            <input type="number" name="amount" min="1" step="0.01" max="@Model.Balance" class="form-control" />
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="col-md-offset-2 col-md-10">
                            <input type="submit" value="Withdraw Funds" class="btn btn-warning" />
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>

    <hr />
    
    <h4>Transaction History</h4>
    @if (Model.Transactions != null && Model.Transactions.Any())
    {
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Type</th>
                    <th>Amount</th>
                    <th>Balance Before</th>
                    <th>Balance After</th>
                    <th>Description</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var transaction in Model.Transactions.OrderByDescending(t => t.TransactionDate))
                {
                    <tr>
                        <td>@transaction.TransactionDate.ToString("MM/dd/yyyy HH:mm")</td>
                        <td>@transaction.TransactionType</td>
                        <td class="@(transaction.Amount >= 0 ? "text-success" : "text-danger")">
                            @transaction.Amount.ToString("C")
                        </td>
                        <td>@transaction.BalanceBefore.ToString("C")</td>
                        <td>@transaction.BalanceAfter.ToString("C")</td>
                        <td>@transaction.Description</td>
                    </tr>
                }
            </tbody>
        </table>
    }
    else
    {
        <p>No transactions found.</p>
    }
</div>

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success">
        @TempData["SuccessMessage"]
    </div>
}

@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-danger">
        @TempData["ErrorMessage"]
    </div>
}

<p>
    @Html.ActionLink("Back to Dashboard", "Index")
</p>