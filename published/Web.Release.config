<?xml version="1.0"?>

<!-- For more information on using Web.config transformation visit https://go.microsoft.com/fwlink/?LinkId=301874 -->

<configuration xmlns:xdt="http://schemas.microsoft.com/XML-Document-Transform">
  
  <!-- Azure SQL Database Connection String -->
  <connectionStrings>
    <add name="DefaultConnection" 
         connectionString="Server=tcp:connect2usserver.database.windows.net,1433;Initial Catalog=Connect2US;Persist Security Info=False;User ID=Connect_Admin;Password=Test@123;MultipleActiveResultSets=False;Encrypt=True;TrustServerCertificate=False;Connection Timeout=30;"
         providerName="System.Data.SqlClient"
         xdt:Transform="SetAttributes" xdt:Locator="Match(name)"/>
  </connectionStrings>
  
  <!-- Azure App Settings -->
  <appSettings>
    <!-- Update Stripe keys for production -->
    <add key="StripePublishableKey" value="pk_test_51SE6jBIGZo4afP6B8oYwwNRUJ7DKUX7GRL2OZyfjnThuokBZvQo0NQE1ZFmwBQLNFq4MHOzviwc2aeHiGjp4pzk1006IbMILZm" xdt:Transform="SetAttributes" xdt:Locator="Match(key)"/>
    <add key="StripeSecretKey" value="YOUR_STRIPE_SECRET_KEY_HERE" xdt:Transform="SetAttributes" xdt:Locator="Match(key)"/>
    
    <!-- Domain and production settings -->
    <add key="WebsiteDomain" value="https://connect2us.co.za" xdt:Transform="Insert"/>
    <add key="WebsiteUrl" value="https://connect2us.co.za" xdt:Transform="Insert"/>
    <add key="EnableSSL" value="true" xdt:Transform="Insert"/>
    
    <!-- Azure-specific settings -->
    <add key="ASPNETCORE_ENVIRONMENT" value="Production" xdt:Transform="Insert"/>
    <add key="WEBSITE_RUN_FROM_PACKAGE" value="1" xdt:Transform="Insert"/>
  </appSettings>
  
  <system.web>
    <compilation xdt:Transform="RemoveAttributes(debug)" />
    
    <!-- Production error handling -->
    <customErrors mode="RemoteOnly" defaultRedirect="Error.aspx" xdt:Transform="Replace">
      <error statusCode="404" redirect="404.aspx"/>
      <error statusCode="500" redirect="500.aspx"/>
    </customErrors>
    
    <!-- Production security settings -->
    <httpCookies httpOnlyCookies="true" requireSSL="true" xdt:Transform="Insert"/>
  </system.web>
  
  <!-- Security Headers -->
  <system.webServer>
    <httpProtocol>
      <customHeaders>
        <add name="X-Frame-Options" value="DENY" xdt:Transform="Insert"/>
        <add name="X-Content-Type-Options" value="nosniff" xdt:Transform="Insert"/>
        <add name="X-XSS-Protection" value="1; mode=block" xdt:Transform="Insert"/>
        <add name="Strict-Transport-Security" value="max-age=31536000; includeSubDomains" xdt:Transform="Insert"/>
        <add name="Content-Security-Policy" value="default-src 'self'; script-src 'self' 'unsafe-inline' https://js.stripe.com; frame-src https://js.stripe.com https://hooks.stripe.com; connect-src 'self' https://api.stripe.com; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self' data:;" xdt:Transform="Insert"/>
        <add name="Referrer-Policy" value="strict-origin-when-cross-origin" xdt:Transform="Insert"/>
      </customHeaders>
    </httpProtocol>
  </system.webServer>
  
</configuration>
